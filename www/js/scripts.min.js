// Расширенный header
$('.actionblock__icon_burger').click(function(e){
	e.preventDefault();
	$(this).toggleClass('active');
	var actions = $(this).parents('.actions');
	var header = $(this).parents('.actions').siblings('.header');
	header.addClass('invisible');
	$('.searchblock__categories').removeClass('active');
	$('.searchblock__menu_categories').removeClass('active');
	if ( $(window).width() <1000 ) {
		fixscreen();
	}
	setTimeout(function(){
		header.toggleClass('active');
		actions.toggleClass('fullheader');
	}, 250)
	setTimeout(function(){
		header.removeClass('invisible');
	}, 500)
});
$('.header__burger').click(function(e){
	e.preventDefault();
	var header = $(this).parents('.header');
	header.addClass('invisible');
	header.siblings('.actions').find('.actionblock__icon_burger').removeClass('active');
	unfixscreen();
	setTimeout(function(){
		header.removeClass('active');
	}, 250)
	setTimeout(function(){
		header.removeClass('invisible');
	}, 500)
});

// Меню профиля ЛК
$('.actionblock__username').click(function(e){
	e.preventDefault();
	$('.actionblock__account').toggleClass('active');
})

// Выход из ЛК
$('.actionblock__userinfo .userinfo__logout').click(function(e){
	e.preventDefault();
	$('.actionblock__account').removeClass('active');
	$('.actionblock__account_logged').hide();
	$('.actionblock__account_login').show();
	$('body').attr('data-login', 'logoff');
})

// Лайк в ЛК
$('.actionblock__icon_like').click(function(e){
	e.preventDefault();
	$(this).toggleClass('active');
	$('.reviews__like.active').toggleClass('visible');
})

// Уведомления в ЛК (демо)
$('.actionblock__icon_notification').click(function(e){
	e.preventDefault();
	$(this).toggleClass('active');
})

// Поиск
$('.actionblock__icon_search').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$(this).toggleClass('active');
	$(this).parents('.actionblock').toggleClass('noshadow');
	$(this).parents('.actions').find('.searchblock').removeClass('active');
	$(this).parents('.actions').find('.searchblock__searchfield').toggleClass('active');
	$(this).parents('.actions').siblings('.overlay').toggleClass('active');
})
$('.searchblock__searchfield').click(function(e){
	e.stopPropagation();
})
$('html').click(function(){
	$('.actionblock__icon_search').removeClass('active');
	$('.actionblock').removeClass('noshadow');
	$('.searchblock__searchfield').removeClass('active');
	$('.overlay').removeClass('active');
})

// Фильтр при скролле
$('.actionblock__icon_filter').click(function(e){
	e.preventDefault();
	$(this).toggleClass('active');
	$(this).parents('.actions').find('.searchblock').toggleClass('active');
})


// Изменение блока действий при скролле
$(window).scroll(function(){
    var scroll = $(this).scrollTop();
	var headerheight = $('.header').outerHeight();
	var searchheight = $('.searchblock').outerHeight();
    if ( scroll >= 60 ) {
		$(".page_detail .header").addClass("sticky");
		$(".page_detail .actions").addClass("sticky");
    } else {
		$(".page_detail .header").removeClass("sticky");
		$(".page_detail .actions").removeClass("sticky");	
	}
	if ( scroll >= 60+searchheight ) {
        $(".page_detail .actions").addClass("active");
    } else {
		$(".page_detail .actions").removeClass("active"); 
	}
	if ( scroll <= 204 ) {
		$(".page_detail .header").removeClass("active");
		$(".page_detail .actions").removeClass("fullheader");
		$(".page_detail .actions_detail").removeClass("full");
		$('.page_detail .actionblock__icon_burger').removeClass('active');
	} else {
		$(".page_detail .actions_detail").addClass("full");
	}
});


// Выпадающий список в фильтре
$('.searchblock__option a').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$(this).parents('.searchblock__menu').siblings().removeClass('active');
	$(this).parents('.searchblock__menu').toggleClass('active');
	if ( $(this).parent().hasClass('searchblock__option_categories') ) {
		$('.searchblock__categories').toggleClass('active');
		$('.overlay').toggleClass('active');
		$('.header').removeClass('active');
		$('.actionblock__icon_burger').removeClass('active');
		$('.actions').removeClass('fullheader');
	} else {
		$('.searchblock__categories').removeClass('active');
		$('.overlay').removeClass('active');
	}
})
$('html').click(function(){
	$('.searchblock__menu_date').removeClass('active');
})
$('.overlay').click(function(){
	$(this).removeClass('active');
	$('.searchblock__categories').removeClass('active');
	$('.searchblock__menu_categories').removeClass('active');
})

// Выбор параметра фильтра
$('.searchblock__menu [data-value]').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	var typeval = $(this).parents('[data-type]').data('type');
	var val = $(this).data('value');
	$(this).parents('.searchblock__menu').find('[data-default]').text(typeval);	$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').show();
	if (val == 'up') {				$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').addClass('up');
	} else {	$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').removeClass('up');
	}
	$(this).parents('.searchblock__menu').removeClass("active");
})

$('.searchblock__menu [data-type]').click(function(e){
	e.preventDefault();
	var typeval = $(this).data('type');
	$(this).parents('.searchblock__menu').find('[data-default]').text(typeval);	$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').show();
	$(this).parents('.searchblock__menu').removeClass("active");
})


// Добавить параметр фильтра
$('.searchblock__icon_plus').click(function(e){
	e.preventDefault();
	$('.searchblock__leftside').addClass('active');
})

// Убрать параметр фильтра
$('.searchblock__icon_minus').click(function(e){
	e.preventDefault();
	$('.searchblock__leftside').removeClass('active');
})


// Лайк карточки товара
$('.reviews__like').click(function(){
	$(this).toggleClass('active');
});

// Прикрепление файлов в комментарии
$('.comments__formupload').click(function(e){
	e.preventDefault();
	$(this).addClass('active');
	$('.comments__uploads').show();
})

// Удаление файла из комментария
$('.comments__deleteupload').click(function(){
	$(this).parent().hide();
})

// Фильтр в комментариях
$('.comments__shownew span').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$(this).parent().toggleClass('active');
	$(this).siblings('.comments__submenu').toggleClass('active')
})
$('.comments__submenu [data-type]').click(function(e){
	e.preventDefault();
	var typeval = $(this).data('type');
	$(this).parents('.comments__shownew').find('span').text(typeval);
	$(this).parents('.comments__shownew').removeClass("active");
	$(this).parents('.comments__submenu').removeClass("active");
})

$('html').click(function(){
	$('.comments__shownew').removeClass("active");
	$('.comments__submenu').removeClass("active");
})


// Включение кнопки "Отправить" в комментариях при наборе текста
$('.comments__formfield textarea').keyup(function(){
	$(this).parents('form').find('button').removeAttr('disabled');
})

// Дополнительные действия в комментариях
$('.comments__actionicon_link').click(function(e){
	e.preventDefault();
	if ( $(this).hasClass('active') ) {
		$('.comments__actionicons .active').removeClass('active');
	} else {
		$('.comments__actionicons .active').removeClass('active');
		$(this).addClass('active');
		$(this).siblings('.comments__link').addClass('active');
	}
})

$('.comments__actionicon_share').click(function(e){
	e.preventDefault();
	if ( $(this).hasClass('active') ) {
		$('.comments__actionicons .active').removeClass('active');
	} else {
		$('.comments__actionicons .active').removeClass('active');
		$(this).addClass('active');
		$(this).siblings('.comments__share').addClass('active');
	}
})

$('.comments__actionicon_more').click(function(e){
	e.preventDefault();
	if ( $(this).hasClass('active') ) {
		$('.comments__actionicons .active').removeClass('active');
	} else {
		$('.comments__actionicons .active').removeClass('active');
		$(this).addClass('active');
		$(this).siblings('.comments__addactions').addClass('active');
	}
})

// Добавить обзор в избранное
$('.share__icon_like').click(function(e){
	e.preventDefault();
	$(this).addClass('active');
});

// Оценка обзора
function starRating(el) {
	var starindex = $(el).parent().index('.share__icon_star');
	starindex++;
	console.log(starindex);
	if ( starindex == 1 ) {
		$('.share__icon_star').removeClass('two three four five');
		$(el).parent().addClass('one');
		$(el).parent().prevAll('.share__icon_star').addClass('one');
		$('.share__myrating').removeClass('two three four five');
		$('.share__myrating').addClass('one');
	}
	
	if ( starindex == 2 ) {
		$('.share__icon_star').removeClass('one three four five');
		$(el).parent().addClass('two');
		$(el).parent().prevAll('.share__icon_star').addClass('two');
		$('.share__myrating').removeClass('one three four five');
		$('.share__myrating').addClass('two');
	}
	
	if ( starindex == 3 ) {
		$('.share__icon_star').removeClass('one two four five');
		$(el).parent().addClass('three');
		$(el).parent().prevAll('.share__icon_star').addClass('three');
		$('.share__myrating').removeClass('one two four five');
		$('.share__myrating').addClass('three');
	}
	
	if ( starindex == 4 ) {
		$('.share__icon_star').removeClass('one two three five');
		$(el).parent().addClass('four');
		$(el).parent().prevAll('.share__icon_star').addClass('four');
		$('.share__myrating').removeClass('one two three five');
		$('.share__myrating').addClass('four');
	}
	
	if ( starindex == 5 ) {
		$('.share__icon_star').removeClass('one two three four');
		$(el).parent().addClass('five');
		$(el).parent().prevAll('.share__icon_star').addClass('five');
		$('.share__myrating').removeClass('one two three four');
		$('.share__myrating').addClass('five');
	}
}

$('.share__icon_star span').hover(function(){
	starRating(this);
	$(this).addClass('hover');
	$(this).prev().addClass('hover');
	$(this).parent().addClass('hover');
	$(this).parent().prevAll('.share__icon_star').addClass('hover');
	$(this).parent().prevAll('.share__icon_star').find('span').addClass('hover');
	},
	function(){
	$(this).removeClass('hover');
	$(this).prev().removeClass('hover');
	$(this).parent().removeClass('hover');
	$(this).parent().prevAll('.share__icon_star').removeClass('hover');
	$(this).parent().prevAll('.share__icon_star').find('span').removeClass('hover');
})

$('.share__icon_star span').click(function(){
	starRating(this);
	$(this).addClass('active');
	$(this).prev().addClass('active');
	$(this).parent().addClass('active');
	$(this).parent().prevAll('.share__icon_star').addClass('active');
	$(this).parent().prevAll('.share__icon_star').find('span').addClass('active');
	$('.share__icon_star').addClass('noclick');
	var rating = $(this).data('rating');
	$('.share__myrating span').text(rating);
	$('.share__myrating').addClass('active');
	$('.thanks').addClass('active');
	setTimeout(function(){
		$('.thanks').removeClass('active');
	}, 3000);
	
	$('.loginform__heading_main').hide();
	$('.loginform__heading_vote').show();
})

// Закрытие выплывающей плашки после оценки
$('.thanks__ok').click(function(e){
	e.preventDefault();
	$('.thanks').removeClass('active');
})


// Закрытие логин попапа в мобилке
$('.loginform__close').click(function(e){
	$.fancybox.close();
});


// AJAX форма
$(document).ready(function() {
    $('#loginform').ajaxForm(function() {
        // Успешная отправка формы
		$.fancybox.close();
        $('.actionblock__account_login').hide();
		$('.actionblock__account_logged').show();
		$('body').attr('data-login', 'logon');
    });
	$('#searchform').ajaxForm(function() {
        // Успешная отправка формы
		$('.actionblock__icon_search').removeClass('active');
		$('.actionblock').removeClass('noshadow');
        $('.searchblock__searchfield').removeClass('active');
		$('.overlay').removeClass('active');
    });
}); 

// Переключение вида карточек товаров
$('.searchblock__icon_view').click(function(e){
	e.preventDefault();
	$('.searchblock__icon_view.active').removeClass('active');
	$(this).addClass('active');
	$('.reviews__cards').addClass('invisible');
	var view = $(this).data('view');
	if ( view == 'stripes' ) {
		setTimeout(function(){
			$('.reviews__cards').addClass('stripes');
		}, 250)
	} else {
		setTimeout(function(){
			$('.reviews__cards').removeClass('stripes');
		}, 250)
	}
	setTimeout(function(){
		$('.reviews__cards').removeClass('invisible');
	}, 500)
})


// Статус автора обзора
$(document).ready(function(){
	$('.usercard__statusbar_talent path').attr('d', 'M 70,0 A69,69 0 1 1 29,125.5');
	$('.usercard__statusbar_master path').attr('d', 'M 70,0 A69,69 0 1 1 3,47');
	$('.usercard__statusbar_writer path').attr('d', 'M 70,0 A69,69 0 0 1 110,125.5');
	$('.usercard__statusbar_novice path').attr('d', 'M 70,0 A69,69 0 0 1 135,49');
});


// Панель действий на странице обзора
$('.detail__action_hide').click(function(e){
	e.preventDefault();
	$(this).parent().addClass('active');
});
$('.detail__action_allow').click(function(e){
	e.preventDefault();
	$(this).parent().removeClass('active');
});


// Выпадающие списки сортировки ТОП на странице обзора
$('.sorting-list__link').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$(this).parent().toggleClass('active');
});
$('html').click(function(){
	$('.sorting-list').removeClass('active');
});
$('.sorting-list__submenu a').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	var text = $(this).text();
	$(this).parents('.sorting-list').removeClass('active');
	
	if (!$(this).parents('.sorting-list').hasClass("sorting-list_nochange")) {
		$(this).parents('.sorting-list').find('.sorting-list__link').text(text);
	} else {
		$(this).parents('.sorting-list').find(".ebay-reviews-icons__icon").hide();
		var review = $(this).data("reviews");
		if (review === "all") {
			$(this).parents('.sorting-list').find(".ebay-reviews-icons__icon").show();
		}
		
		if (review === "good") {
			$(this).parents('.sorting-list').find(".ebay-reviews-icons__icon_good").show();
		}
		
		if (review === "normal") {
			$(this).parents('.sorting-list').find(".ebay-reviews-icons__icon_normal").show();
		}
		
		if (review === "bad") {
			$(this).parents('.sorting-list').find(".ebay-reviews-icons__icon_bad").show();
		}
	}
});
$('.sorting-list').click(function(e){
	e.stopPropagation();
});




// Навигация карточек на странице обзора
$(document).ready(function(){
	$('.cardnav').each(function(){
		var navcards = $(this).siblings('.js-navcards');
		var containerWidth = navcards.width();
		var cardsWidth = 0;
		navcards.children().each(function(){
			cardsWidth = cardsWidth + $(this).outerWidth(true);
		});
		if ( cardsWidth > containerWidth ) {
			$(this).addClass('right-arrow');
		}
	});
});

$('.cardnav__arrow').click(function(e){
	e.preventDefault();
	var navcards = $(this).parent().siblings('.js-navcards');
	var containerWidth = navcards.width();
	var cardsWidth = 0;
	navcards.children().each(function(){
		cardsWidth = cardsWidth + $(this).outerWidth(true);
	});
	var containerTranslation = parseInt(navcards.css('transform').split(',')[4]);
	containerTranslation = Math.abs(containerTranslation);
	var diffWidth = cardsWidth - containerWidth - containerTranslation;
	if ( $(this).hasClass('next') ) {
		if ( diffWidth < 0 ) {
			return false;
		} else if ( diffWidth >= 0 && diffWidth <= containerWidth ) {
			navcards.css('transform', 'translate3d(-'+(diffWidth+containerTranslation)+'px,0,0)');
			$(this).parent().removeClass('right-arrow');
			$(this).parent().addClass('left-arrow');
		} else {
			navcards.css('transform', 'translate3d(-'+(containerWidth+containerTranslation)+'px,0,0)');
			$(this).parent().addClass('left-arrow');
		}
	} else {
		if ( containerTranslation == 0 ) {
			return false;
		} else if ( containerTranslation > 0 && containerTranslation <= containerWidth ) {
			navcards.css('transform', 'translate3d(0,0,0)');
			$(this).parent().removeClass('left-arrow');
			$(this).parent().addClass('right-arrow');
		} else {
			navcards.css('transform', 'translate3d(-'+(containerTranslation-containerWidth)+'px,0,0)');
			$(this).parent().addClass('right-arrow');
		}
	}
});



//  Добавляем/убираем значок "больше" при длинном value в input
$("input[name='seller']").on("keyup change", function(){
    if ($(this).val().length > 45) {
        $(this).parents("form").addClass("filled");
    } else {$(this).parents("form").removeClass("filled");}
});



// Появление кнопки проверки в форме на первом экране
$('.formscreen input').keyup(function(){
	if ( $(this).val() ) {
		$(this).parent().siblings().find('button').addClass('active');
		if ( $(window).width() < 1000 ) {
			$(this).parents('form').siblings('img').addClass('active');
		}
	} else {
		$(this).parent().siblings().find('button').removeClass('active');
		$(this).parents('form').siblings('img').removeClass('active');
	}
});


// Альтернативное плавное появление шапки на первом экране
$(document).ready(function(){
	$('.page_main .formscreen_ebay .header .container').addClass('animated fadeInDown');
});



// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal = {delay: 100, origin:'top', distance: '40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooReveal1 = {delay: 200, origin:'top', distance: '40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
sr.reveal('.detail__header, .detail__reviewinfo, .detail__textblock, .detail__imageblock, .detail__linkblock, .share__block, .share__bottom, .subscribe__form, .topauthors__heading, .interesting__heading, .comments__heading, .comments__block, .comments__firsttext, .comments__loginblock', fooReveal);
sr.reveal('.detail__authorinfo, .page_detail .container_navcards, .comments__form, .comments__topcomments', fooReveal1);



// Показываем подробную инфу ebay
$(".second__detail-button").click(function(e){
	e.preventDefault();
	var allblock = $(".ebay-allinfo");
	
	$(this).addClass("active");
	allblock.show();
	$('html,body').animate({scrollTop:allblock.offset().top}, 1200);
	setTimeout(function(){
		allblock.addClass("active");
	}, 1);
});



// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}



// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});




// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}



// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){     
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});




// Всплывающие окна
$(".fancybox").fancybox({
    fitToView   : false,
    autoSize    : true,
    openEffect  : 'fade',
    closeEffect : 'fade',
	padding		: 0,
	margin		: 0,
});



// Проверка формы на правильность введенных данных
$(".fake-button").click(function(){
    window.activeform = $(this).parents("form").attr("id");

    checkselects();
    checkinputs();
    checkandsubmit();
});

// 1. Проверка селектов
function checkselects() {
    if (select1val === false) { $('#'+activeform+' select[name="city"]').parent().addClass("error"); }
    if (select2val === false) { $('#'+activeform+' select[name="clienttype"]').parent().addClass("error"); }
    if (select3val === false) { $('#'+activeform+' select[name="orgform"]').parent().addClass("error"); }
}

// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();
    
    // Проверка поля email
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    if ( isEmail($('#'+activeform+' input[name="email"]').val()) === false) {
        $('#'+activeform+' input[name="email"]').parent().addClass("error")
    } else {$('#'+activeform+' input[name="email"]').parent().removeClass("error")}
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $('#'+activeform).find("div.error").each(function(){
        formerrors += 1; 
    });
    if (formerrors === 0) {
        $('#'+activeform).submit();
    }
}

// Скрипт проверки на пустое значение
function checkempty() {
    $('#'+activeform+' input[data-required]').each(function(){
        if (!$(this).val()) {
            $(this).parent().addClass("error")
        } else {$(this).parent().removeClass("error")}
    });
}

// Проверка номера телефона
function phonenumerlength() {
   if ( $('#'+activeform+' input[name="tel"]').val().match(/\d/g).length < 11) {
       $('#'+activeform+' input[name="tel"]').addClass("error")
   } else {$('#'+activeform+' input[name="tel"]').removeClass("error")}
}

// Убрать ошибку при изменении input'а
$("input").on("keyup change", function(){
   $(this).parent().removeClass("error"); 
});

// Только цифры в input'е
$('.onlynumber').change(function(e){
  if (/\D/g.test(this.value))
  {
    this.value = this.value.replace(/\D/g, '');
  }
});

// ################## //
// Только буквы в input'е
// ################## //
$('.letteronly').bind('keyup blur',function(){ 
    var node = $(this);
    node.val(node.val().replace(/\d/g,'') ); }
);



/*//Послайдовый скролл (Pagepiling)
$(document).ready(function() {
	if ( $(window).width() > 1000 ) {
		$('.pagepiling').pagepiling({
			anchors: ['ebay', 'reviews', 'mytrack', 'forums'],
    		verticalCentered: false,
			navigation: false,
			normalScrollElements: '.formscreen .sorting-list__submenu',
			onLeave: function(index, nextIndex, direction){
				if(index == 2 && direction =='down'){
					$('.formscreen_mytrack .animated').addClass('bounceInUp')
				}
			}
		});
	}
});*/



//Перезагрузка страницы при переходе на мобильную версию и обратно
window.desktop;
window.newdesktop;

function checkpagewidth() {
    if ( $(window).width() > 1000 ) {
        desktop = true;
    } else { desktop = false; }

    $(window).resize(function(){
        if ( $(window).width() > 1000 ) { 
            newdesktop = true;
        } else { newdesktop = false; }
        
        if ( newdesktop != desktop ) {
            location.reload();
        }
    });
}

checkpagewidth();



// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});



// Кросс-браузерный Placeholder
function supports_input_placeholder() {var i = document.createElement('input'); return 'placeholder' in i;}

if (!supports_input_placeholder()) {
  var fields = document.getElementsByTagName('INPUT');
  for(var i=0; i < fields.length; i++) {
    if(fields[i].hasAttribute('placeholder')) {
      fields[i].defaultValue = fields[i].getAttribute('placeholder');
      fields[i].onfocus = function() { if(this.value == this.defaultValue) this.value = ''; }
      fields[i].onblur = function() { if(this.value == '') this.value = this.defaultValue; }
    }
  }
}

// Custom Scrollbar
$(document).ready(function(){
	$('.scrollbar-inner').scrollbar();
});


// VerstaScroll
$.fn.scrollEnd = function(callback, timeout) {          
	$(this).scroll(function(){
    	var $this = $(this);
    	if ($this.data('scrollTimeout')) {
      		clearTimeout($this.data('scrollTimeout'));
    	}
    	$this.data('scrollTimeout', setTimeout(callback,timeout));
  	});
};

$.fn.verstaScroll = function() {
	console.log('versta');
	var cont = this,
  	slideClass = ".section",
  	slide = this.find(slideClass),
    overlayClass = ".section-overlay",
    activeSlideNum = 0,
    activeSlide,
    thisPos,
    sT,
    prevSlide,
    currentPercent,
    activePos,
    currentViewportPercent,
    nextSlide,
    scrollTarget;
      
	function loadInit() {
  		slide.css({
    		transform: "translate3d(0,0,0)",
    	});
    
    	slide.each(function(){
   			$(this).attr("data-pos", $(this).offset().top);
    	});
  	}
  
  	function scrollProcess() {
  		$(window).scroll(function(){
    		sT = $(this).scrollTop();
      		windowHeight = $(this).height();
      
      		// Находим активный слайд
    		slide.each(function(){
      			thisPos = $(this).data("pos");        
      			if ( sT + windowHeight > ( thisPos ) ) {
        			activeSlideNum = $(this).index();
        		}
      		});
      
      		console.log(activeSlideNum);
      
      		// Анимируем предыдущий на процент от скролла текущего
      		activeSlide = cont.find(slideClass + ":eq(" + activeSlideNum + ")");
      		prevSlide = activeSlide.prev(slideClass);
      		nextSlide = activeSlide.next(slideClass);
      		activePos = activeSlide.data("pos");      
      		currentPercent = (sT + windowHeight - activePos) / activeSlide.outerHeight();
      		currentViewportPercent = (sT + windowHeight - activePos) / windowHeight;
          
      		if ( prevSlide.length > 0 ) {
      			// Transform у предыдущего слайда
      			prevSlide.css({
        			transform: "translate3d(0, " + 150*currentViewportPercent + "px, 0)"
        		});
        
        		// Прозрачность у overlay предыдущего слайда
      			prevSlide.find(overlayClass).css({
      				opacity: (0.5*currentViewportPercent )
      			});
      		}
        
        	if ( prevSlide.index() == 1 ) {
            	$('.formscreen_mytrack .animated').addClass('bounceInUp');
        	}
      
      		// Докрутка до активного слайда
  			$(window).scrollEnd(function(){
      			if (currentViewportPercent >= 0.5) {
        			// Скроллим вниз
        			scrollTarget = activeSlide.data("pos");
            		if ( activeSlide.outerHeight() < windowHeight ) {
        	  			scrollTarget = activeSlide.data("pos") - ( windowHeight - activeSlide.outerHeight() );
        	  		}
        		} else {
        			// Скроллим вверх
        			scrollTarget = prevSlide.data("pos") - ( windowHeight - prevSlide.outerHeight() );

        	  		if ( prevSlide.outerHeight() < windowHeight ) {
        	  			scrollTarget = prevSlide.data("pos") - ( windowHeight - prevSlide.outerHeight() );
        	  		}
            
            		// Если слайд последний
            		if ( nextSlide.length <= 0 ) {
            			scrollTarget = $(document).height() - windowHeight;
					}
        		}
        		$("body, html").stop().animate({scrollTop: scrollTarget}, '1200');
			}, 700);
    	});
  	}
	
  	loadInit();
  	scrollProcess();
};

$(document).ready(function(){
   if ( $(window).width() > 1000 && $('.verstaScroll').length ) {
//       $(".verstaScroll").verstaScroll();
   } 
});


/*-------------------------------------------------*/
/*---------------------- Ebay ---------------------*/
/*-------------------------------------------------*/

// Текст ссылки при клике на значок more
$('.inputblock .more').click(function(e){
	e.stopPropagation();
	var inputVal;
	if ( $(this).next('input').length ) {
		inputVal = $(this).next().val();
	} else {
		inputVal = $(this).next().text();
	}
	$(this).siblings('.inputlink').text(inputVal);
	$(this).siblings('.inputlink').toggleClass('active');
});
$('.inputlink').click(function(e){
	e.stopPropagation();
});
$('html').click(function(){
	$('.inputlink').removeClass('active');
});


// Ebay header
$(window).scroll(function(){
	var scrollpos = $(this).scrollTop();
	var headerdistance = $('.second_top').offset().top;
	if ( scrollpos >= headerdistance) {
		$('.second .header').addClass('sticky');
		$('.second .actions').addClass('ebay');
	} else {
		$('.second .header').removeClass('sticky');
		$('.second .actions').removeClass('ebay');
	}
});



// Показать, если хороший
function showgood() {
    $("section.second").addClass("good").removeClass("bad");
    $("#yesorno").text("Да, можно покупать");
    var rating = "85";
    $("#ratingnumber").text(rating);
    var textrating = "очень хороший";
    $("#textrating").text(textrating);
}

// Показать плохой
function showbad() {
    $("section.second").removeClass("good").addClass("bad");
    $("#yesorno").text("Не нужно покупать");
    var rating = "35";
    $("#ratingnumber").text(rating);
    var textrating = "плохой";
    $("#textrating").text(textrating);
}



// AJAX форма
$(document).ready(function() {
    $('.page_ebay .formscreen form').ajaxForm(function() {
        // Успешная отправка формы
        $(".actionblock__sellerlink").text($(".page_ebay .formscreen_ebay input[name='seller']").val());

        if ($("section.firstscreen input[name='seller']").val() === "bad") {
            showbad();
        }

        if ($("section.firstscreen input[name='seller']").val() === "good") {
            showgood();
        }

        var height = $(".page_ebay .formscreen_ebay").outerHeight();
        $(".page_ebay .formscreen_ebay").css("height", height+"px");

		$('.siteloader').addClass('active');
		sitepreloader();

        setTimeout(function(){
			$("body").addClass("active");
			$('body').scrollTop(0);
            $(".ebay-content").css("margin-top", "-"+(height-1)+"px");
        }, 10500);

        $(window).scroll(function(){
            scrollsecond();
        });
	});

	$('.topblock form').ajaxForm(function() {
        // Успешная отправка формы
        if ($(".topblock .inputblock input").val() != "") {
            $(".topblock").removeClass("active");

            if ($(".topblock .inputblock input").val() === "bad") {
                showbad();
            }

            if ($(".topblock .inputblock input").val() === "good") {
                showgood();
            }

            $(".actionblock__sellerlink").text($(".topblock input").val());

            $(".topblock .inputblock input").val("");
			$('.topblock .button').removeClass('active');
        } else {
            showerror("emptyerror");
        }
	});
});


// Добавить в избранное
function addtobookmarks() {
    var url = $("#tofavourites").prev().text();

    if (window.sidebar && window.sidebar.addPanel) { // Mozilla Firefox Bookmark
      window.sidebar.addPanel(document.title, url, '');
    } else if (window.external && ('AddFavorite' in window.external)) { // IE Favorite
      window.external.AddFavorite(url, document.title);
    } else if (window.opera && window.print) { // Opera Hotlist
      this.title = document.title;
      return true;
    } else { // webkit - safari/chrome
      alert('Нажмите ' + (navigator.userAgent.toLowerCase().indexOf('mac') != -1 ? 'Command/Cmd' : 'CTRL') + ' + D, чтобы добавить страницу в закладки.');
    }

//    showerror("bookmarkinfo");
}

$('#tofavourites').click(function() {
    addtobookmarks();
});


//Preloader
$(document).ready(function(){

});

function sitepreloader() {
	$('.siteloader__circles, .siteloader__progress').addClass('visible');
	setTimeout(function(){
		window.activeCircleIndex = 1;
		circlefunc();
		progressbar();
		percentcount();
		changetext();
	}, 500);

}

function circlefunc() {
	var activeCircle = $(".siteloader__icon:nth-of-type("+activeCircleIndex+")");

	if (activeCircleIndex == 5) {
		setTimeout(function(){
			activeCircle.addClass("siteloader__icon_pink");
		}, 2000);
		setTimeout(function(){
			$('.siteloader__circles, .siteloader__progress').removeClass('visible');
			$('.siteloader').removeClass('active');
		}, 3000);

   	} else {


     	setTimeout(function(){
			activeCircle.addClass("siteloader__icon_white siteloader__icon_right-dark")
		}, 0);

		setTimeout(function(){
			activeCircle.addClass(" siteloader__icon_right-pink");
			activeCircle.next().addClass("siteloader__icon_left-dark");
		}, 1000);

     	setTimeout(function(){
			activeCircle.addClass("siteloader__icon_pink");
			activeCircle.next().addClass("siteloader__icon_white siteloader__icon_left-pink");

       		activeCircleIndex += 1;
       		circlefunc();
     	}, 2000);
	}
}

function progressbar() {
	$('.siteloader__progress_bar_progressive').addClass('active');
	$('.siteloader__progress_texts').addClass('active');
}

function percentcount() {
	var counter = 100;
	$({countNum: 0}).animate({countNum: counter}, {
    	duration: 10000,
        easing:'linear',
        step: function() {
        	$('.siteloader__progress_texts_percent span').text(Math.floor(this.countNum));
        },
        complete: function() {
            $('.siteloader__progress_texts_percent span').text(this.countNum);
        }
	});
}

function changetext() {
	setTimeout(function(){
		$('.siteloader__progress_texts_text').text('Отправляю запрос');
    }, 2000);
	setTimeout(function(){
		$('.siteloader__progress_texts_text').text('Жду ответ');
    }, 4000);
	setTimeout(function(){
		$('.siteloader__progress_texts_text').text('Получаю данные');
    }, 6000);
	setTimeout(function(){
		$('.siteloader__progress_texts_text').text('Анализирую продавца');
    }, 8000);
}


// Смена блоков в плашке
$("a[href='#change']").click(function(event){
	event.preventDefault();
	$(".topblock").addClass("active");
});

$(".topblock a[href='#cancel']").click(function(event){
	event.preventDefault();
	$(".topblock").removeClass("active");
});


// Появление кнопки проверки в форме выплывающего блока
$('.topblock input').keyup(function(){
	if ( $(this).val() ) {
		$(this).parent().siblings().find('button').addClass('active');
	} else {
		$(this).parent().siblings().find('button').removeClass('active');
	}
});